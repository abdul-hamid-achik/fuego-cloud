---
- name: Configure K3s cluster
  hosts: k3s_cluster
  become: true
  gather_facts: true
  roles:
    - role: k3s

- name: Install Traefik ingress
  hosts: master
  become: true
  gather_facts: false
  roles:
    - role: traefik

- name: Install cert-manager for TLS
  hosts: master
  become: true
  gather_facts: false
  roles:
    - role: cert-manager
  tags:
    - cert-manager
    - tls

- name: Install sealed-secrets for encrypted secrets
  hosts: master
  become: true
  gather_facts: false
  roles:
    - role: sealed-secrets
  tags:
    - sealed-secrets
    - security

- name: Install monitoring stack
  hosts: master
  become: true
  gather_facts: false
  roles:
    - role: monitoring
  tags:
    - monitoring
    - prometheus
    - grafana
